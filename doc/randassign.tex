% Docs for randassign
% G. M. Poore, 2013

\documentclass[11pt]{article}

\usepackage{fixltx2e}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}

\usepackage{fancyvrb}
\DefineShortVerb{\|}

\newcommand{\pytex}{Python\TeX}
\newcommand{\ra}{\texttt{randassign}}

\title{\texttt{randassign} \\~\\ A Python Module for \\ Randomized Assignments with \pytex}
\author{Geoffrey M.\ Poore}
\date{}


\begin{document}

\maketitle


\section{Introduction}

The \pytex\ package for \LaTeX\ makes it simple to create randomized \LaTeX\ documents, by providing access to Python's random number generators.  
This concept may be extended to the creation of randomized assignments for students.  The same assignment may be generated multiple times, each time with a different seed for the random number generators.

Creating a randomized assignment is relatively straightforward.  Incorporating student names, allowing for multiple attempts, and tracking solutions adds additional complexity.  The \ra\ Python module is designed to automatically manage these aspects of randomized assignments.


\section{The \ra\ module}

\subsection{The \texttt{RandAssign()} class}

The \ra\ module provides a |RandAssign()| class.  An instance of this class should be created within the Python session that generates solutions.  For example,
\begin{Verbatim}
\begin{pycode}
from randassign import RandAssign
ra = RandAssign()
\end{pycode}
\end{Verbatim}

The class instance contains a list called |soln| in which solutions may be accumulated.  For example,
\begin{Verbatim}
ra.soln.append('The answer is {0}\n'.format(ans))
\end{Verbatim}
Notice that any desired linebreaks should be included explicitly, unless you have customized things.

At the end of the document, the elements of this list need to be written to file.  This is accomplished by calling the |cleanup()| method.  For example, 
\begin{Verbatim}
\begin{pycode}
ra.cleanup()
\end{pycode}
\end{Verbatim}

The format of the solutions is controlled by the |solnfmt| property.  For example,
\begin{Verbatim}
ra.solnfmt = '.txt'
\end{Verbatim}
Currently, three formats are supported:  plain text (|.txt|), comma-separated values (|.csv|), and \TeX\ (|.tex|).  The format may be given with or without the period.


\subsection{The \texttt{make()} function}

The \ra\ module also includes a |make()| function.  This is used to generate randomized assignments automatically.  A typical make script might look something like this:
\begin{Verbatim}
from randassign import make
make()
\end{Verbatim}
This script will search the current directory for a \TeX\ file.\footnote{Files called \texttt{name.tex} and \texttt{attempt.tex} are ignored, for reasons discussed below.}  If it only finds a single \TeX\ file, it will assume that that is the randomized assignment.  Then it looks for a list of students (default:  |students.txt|).  It creates a directory for assignments (default: |randassign_|$\langle$\textit{jobname}$\rangle$).  Finally, it creates an assignment for each student, and stores all assignments and solutions in the directory.

The make script can be customized by providing optional arguments to the |make()| function.
\begin{itemize}
\item |outdir|:  The directory for solutions.  Default:  |randassign_|$\langle$\textit{jobname}$\rangle$.
\item |student|:  An individual student for whom to create an assignment.  This is for when you only wish to create an assignment for a single student.  Overrides the list of students.  The last name of the student can be supplied, and then the full name will be determined automatically from the list of students.
\item |students|:  A file containing a list of students (one per line, plain text).  Default:  |students.txt|.
\item |texfile|:  The \TeX\ file to process.  Default:  the \TeX\ file in the current directory.  If there is more than one \TeX\ file, the file must be specified.  The |.tex| extension may be left off.
\item |texcmd|:  The \TeX\ command to use.  Should be a list, since it is used by |subprocess|.  Default:  |['pdflatex', '-interaction=nonstopmode']|.
\item |writesoln|:  The function that writes solutions.  A custom function may be supplied if you wish to add another solution format or customize how current formats are treated.  The function must take three arguments:  |data|, a dictionary of student names, each of which is linked to a list of solutions (one solution per attempt); |outdir|, the directory for storing solutions; and |fmt|, the solution format.
\end{itemize}

The |make()| function also checks for optional command-line arguments that parallel these optional arguments.  If a command line argument is present, it overrides the equivalent optional argument.
\begin{itemize}
\item |--student|
\item |--students|
\item |--outdir|
\item |[TEXFILE]|
\end{itemize}


\section{Creating Randomized \LaTeX\ documents with \ra}

\subsection{Requirements}

\LaTeX\ documents using \ra\ must follow a few simple conventions.
\begin{itemize}
\item Use \pytex, of course.
\item Load \ra\ in the Python session that generates solutions.  If only a single session is ever used, this could be done via the |pythontexcustomcode| environment.  Keep in mind that currently, \textbf{only a single session} is supported for generating solutions.
\item The name of the current student should be accessed via |\input| from a file |name.tex|.
\item The number of the current attempt (if any) should be accessed via |\input| from a file |attempt.tex|.
\end{itemize}

\subsection{Example}

This may be made more concrete by considering a simple example.  We create the |attempt.tex| and |name.tex| files that will be needed for the main \TeX\ file.  The |\endinput| is just to prevent unwanted space after the included content; you don't have to actually worry about this in practice, because the make script takes care of everything.
\VerbatimInput[frame=single, label=attempt.tex]{attempt.tex}

\VerbatimInput[frame=single, label=name.tex]{name.tex}

We create a randomized assignment.
\VerbatimInput[frame=single, label=sample.tex]{sample.tex}

We use a very simple make script, with the name of the \TeX\ file specified.
\VerbatimInput[frame=single, label=make\_sample]{make_sample.py}

And we only have two students:
\VerbatimInput[frame=single, label=students.txt]{students.txt}

We create the assignments by running |python make_sample.py|.  This yields two files, each with its own version of the assignment.
\begin{center}
\fbox{\includegraphics[trim=1in 7in 1in 2in]{randassign_sample/Michael_Faraday_1.pdf}}
\end{center}

\begin{center}
\fbox{\includegraphics[trim=1in 7in 1in 2in]{randassign_sample/Albert_Einstein_1.pdf}}
\end{center}

We also have automatically generated solutions.  In this case, they are in |.tex| format.
\begin{center}
\fbox{\includegraphics[trim=1in 5in 1in 1in]{randassign_sample/solutions.pdf}}
\end{center}

\end{document}